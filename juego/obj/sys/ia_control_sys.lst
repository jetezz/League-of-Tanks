ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 ;;
                              2 ;;IA ENTITY CONTROL SYSTEM
                              3 ;;
                              4 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              5 .include "man/entity_manager.h.s"
                              1 ;;
                              2 ;;entity Manager
                              3 ;;
                              4 
                              5 
                              6 
                              7 .globl create_entities
                              8 .globl entityman_getEntityVector_IX
                              9 .globl entityman_num_entities
                             10 .globl _num_entities
                             11 .globl init_entities
                             12 
                             13 
                             14 ;; Entity definition macro
                             15 
                             16 
                             17 .macro Entity _name,_x,_y,_xl,_yl,_xll,_yll,_vx,_vy,_sh,_iast,_dir,_dead,_ancho,_alto
                             18 _name::
                             19 .db _x      ;;posicion x del tanque
                             20 .db _y	;;posicion y del tanque
                             21 .db _xl	;;posicion de la x anterior
                             22 .db _yl	;;posicion de la y anterior
                             23 .db _xll	;;posicion de la x 2 veces anterior
                             24 .db _yll	;;posicion de la x 2 veces anterior
                             25 .db _vx	;;velocidad en x
                             26 .db _vy	;;velocidad en y
                             27 .db _sh	;;shot 0 no 1 si
                             28 .db _iast;;type 0 jugador por teclas ,1 enemigo ia
                             29 .db _dir    ;;movimiento  
                             30 .db _sh     ;; si no dispara es 0 si dispara es 1
                             31 .db _dead;;canon 0 vivo 1 muere
                             32 .db 0x00, 0x00    ;;iax ia y
                             33 .db _iast  ;;Estado anterior de la ia 
                             34 .dw 0x0000	;; puntero de la patrulla que voy a realizar
                             35 .dw 0x0000 ;;puntero al estado que tengo que saltar
                             36 .db _ancho
                             37 .db _alto
                             38 .db 25  ;; contador cambio direcion del sprite
                             39 
                             40 
                             41 
                             42 
                             43 
                             44 
                             45 .endm 
                             46 
                             47 
                             48 .macro NextEntity
                             49 ld de, #siceof_e
                             50 	add ix, de
                             51 .endm
                             52 	
                             53 
                     0000    54 e_x  	= 0
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                     0001    55 e_y  	= 1
                     0002    56 e_xl  = 2
                     0003    57 e_yl  = 3
                     0004    58 e_xll = 4
                     0005    59 e_yll = 5
                     0006    60 e_vx	= 6
                     0007    61 e_vy	= 7
                     0008    62 e_sh 	= 8
                     0009    63 e_ia_st = 9
                     000A    64 e_dir = 10
                     000B    65 e_sh = 11
                     000C    66 e_dead=12
                     000D    67 e_ia_x= 13
                     000E    68 e_ia_y= 14
                     000F    69 e_ia_st_prev=15
                     0010    70 e_ia_puntero_patrol_h=16
                     0011    71 e_ia_puntero_patrol_l=17
                     0012    72 e_ia_puntero_st_h=18
                     0013    73 e_ia_puntero_st_l=19
                     0014    74 e_ancho 	= 20
                     0015    75 e_alto	= 21
                     0016    76 e_clock     = 22
                     0017    77 siceof_e 	= 23
                             78 
                             79 ;; Movimiento de la entidad
                     0003    80 e_dir_right = 3
                     0002    81 e_dir_top   = 2
                     0001    82 e_dir_left  = 1
                     0004    83 e_dir_bott  = 4
                             84 
                             85 ;; Dibujo que representa el movimiento de la entidad
                             86 
                             87  ;;      2
                             88  ;;     1e3
                             89  ;;      4
                             90 
                             91 
                             92 ;;Estados ia
                     0000    93 e_ia_st_noIA 	= 0
                     0001    94 e_ia_st_stand_by	= 1
                     0002    95 e_ia_st_move_to   = 2
                     0003    96 e_ia_st_patron	= 3
                             97 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              6 .include "man/patrol_manager.h.s"
                              1 ;;
                              2 ;;Patrol manager h
                              3 ;;
                              4 
                              5 ;;
                     FFFFFFFF     6 patrol_invalid_move_x =-1
                              7 
                              8 .globl man_patrol_single_11_get
                              9 .globl man_patrol_single_12_get
                             10 .globl man_patrol_single_13_get
                             11 .globl man_patrol_single_21_get
                             12 .globl man_patrol_single_22_get
                             13 .globl man_patrol_single_23_get
                             14 .globl man_patrol_single_31_get
                             15 .globl man_patrol_single_32_get
                             16 .globl man_patrol_single_33_get
                             17 .globl man_patrol_single_41_get
                             18 .globl man_patrol_single_42_get
                             19 .globl man_patrol_single_43_get
                             20 .globl man_patrol_single_51_get
                             21 .globl man_patrol_single_52_get
                             22 .globl man_patrol_single_53_get
                             23 .globl man_patrol_single_61_get
                             24 .globl man_patrol_single_62_get
                             25 .globl man_patrol_single_63_get
                             26 
                             27 .globl man_patrol_multi_11_get
                             28 .globl man_patrol_multi_12_get
                             29 .globl man_patrol_multi_13_get
                             30 .globl man_patrol_multi_21_get
                             31 .globl man_patrol_multi_22_get
                             32 .globl man_patrol_multi_23_get
                             33 .globl man_patrol_multi_31_get
                             34 .globl man_patrol_multi_32_get
                             35 .globl man_patrol_multi_33_get
                             36 .globl man_patrol_multi_41_get
                             37 .globl man_patrol_multi_42_get
                             38 .globl man_patrol_multi_43_get
                             39 .globl man_patrol_multi_51_get
                             40 .globl man_patrol_multi_52_get
                             41 .globl man_patrol_multi_53_get
                             42 .globl man_patrol_multi_61_get
                             43 .globl man_patrol_multi_62_get
                             44 .globl man_patrol_multi_63_get
                             45 
                             46 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



                              7 .include "sys_create_bullet.h.s"
                              1 ;;
                              2 ;;sys create bullet h
                              3 ;;
                              4 
                              5 .globl sys_create_bullet_init
                              6 .globl create_bullets_array
                              7 .globl hacer_disparo
                              8 
                              9 
                             10 
                     0001    11 _nivel_1x=1
                     0004    12 _nivel_1y=4
                     0002    13 _nivel_2x=2
                     0008    14 _nivel_2y=8
                             15 
                     FFFFFFFF    16 _nivel_1x_n=-1
                     FFFFFFFC    17 _nivel_1y_n=-4
                     FFFFFFFE    18 _nivel_2x_n=-2
                     FFFFFFF8    19 _nivel_2y_n=-8
                             20 
                             21 
                             22 .globl velocidad_balas
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 6.
Hexadecimal [16-Bits]



                              8 .include "sys_create_bullet_2.h.s"
                              1 ;;
                              2 ;;sys create balas 2 h
                              3 ;;
                              4 .globl sys_create_bullet_init2
                              5 .globl hacer_disparo2
                     0001     6 izquierda=1
                     0002     7 arriba =2
                     0003     8 derecha=3
                     0004     9 abajo =4
                             10 
                     0004    11 ancho_canon=4
                     0010    12 alto_canon=16
                             13 
                             14 
                     0001    15 _nivel_1x=1
                     0004    16 _nivel_1y=4
                     0002    17 _nivel_2x=2
                     0008    18 _nivel_2y=8
                             19 
                     FFFFFFFF    20 _nivel_1x_n=-1
                     FFFFFFFC    21 _nivel_1y_n=-4
                     FFFFFFFE    22 _nivel_2x_n=-2
                     FFFFFFF8    23 _nivel_2y_n=-8
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 7.
Hexadecimal [16-Bits]



                              9 .include "ia_control_sys.h.s"
                              1 ;;
                              2 ;;IA ENTITY CONTROL SYSTEM h
                              3 ;;
                              4 
                              5 
                              6 ;; siempre impar que sino la liamos 
                     0033     7 _dificultad_ia_nive1=51
                     0029     8 _dificultad_ia_nive2=41
                     0019     9 _dificultad_ia_nive3=25
                     000F    10 _dificultad_ia_nive4=15
                             11 
                     0001    12 _nivel_1x=1
                     0004    13 _nivel_1y=4
                     0002    14 _nivel_2x=2
                     0008    15 _nivel_2y=8
                             16 
                     FFFFFFFF    17 _nivel_1x_n=-1
                     FFFFFFFC    18 _nivel_1y_n=-4
                     FFFFFFFE    19 _nivel_2x_n=-2
                     FFFFFFF8    20 _nivel_2y_n=-8
                             21 
                             22 
                             23 
                             24 
                             25 
                             26 
                             27 
                             28 .globl sys_ai_control_update
                             29 .globl sys_ai_control_init
                             30 .globl sys_ai_patrol
                             31 .globl sys_ia_stand_by
                             32 
                             33 .globl cambiar_dificultad_ia
                             34 .globl cambiar_velocidad_ia
                             35 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 8.
Hexadecimal [16-Bits]



                             10 .include "man/state_manager.h.s"
                              1 ;;
                              2 ;;Draw map h
                              3 ;;
                              4 
                              5 
                              6 
                              7 .globl manage_game
                              8 .globl jugandostate_init
                              9 .globl set_Ingame
                             10 .globl set_Gameover
                             11 .globl set_Inicio
                             12 .globl _pausa
                             13 .globl _gamemode
                             14 
                             15 .globl get_gamemode
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 9.
Hexadecimal [16-Bits]



   0000 33                   11 _iteraciones_ia: .db #_dificultad_ia_nive1
   0001 00                   12 _contador_ia: .db #_iteraciones_ia
                             13 
   0002 01                   14 _vel_x_ia: .db #_nivel_1x
   0003 04                   15 _vel_y_ia: .db #_nivel_1y
   0004 FF                   16 _vel_x_ia_n: .db #_nivel_1x_n
   0005 FC                   17 _vel_y_ia_n: .db #_nivel_1y_n
                             18 
                             19 
                             20 
                             21 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             22 ;;INIT
                             23 ;;IX = PUNTERO AL ARRAY DE ENTIDADES 
                             24 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   0006                      25 sys_ai_control_init::
   0006 21 01 00      [10]   26 	ld hl , #_contador_ia
                             27 
   0009 3A 00 00      [13]   28 	ld a,(_iteraciones_ia)
   000C 77            [ 7]   29 	ld (hl), a
                             30 
   000D 21 12 00      [10]   31 	ld hl , #_num_patrol
   0010 36 00         [10]   32 		ld (hl),#0
                             33 
                             34 
   0012 00                   35 	_num_patrol: .db 0
   0013 DD 22 3A 00   [20]   36 	ld (_ent_array_prt),ix
   0017 DD 22 3E 00   [20]   37 	ld (_ent_array_inicio), ix
                             38 
                             39 
   001B CD 00 00      [17]   40 	call entityman_num_entities
   001E 32 34 00      [13]   41 	ld (_cont_entidad), a
   0021 21 22 01      [10]   42 	ld hl, #sys_ia_stand_by
   0024                      43 _loop_init:
                             44 	
                             45 
   0024 DD 74 12      [19]   46 	ld e_ia_puntero_st_h (ix), h
   0027 DD 75 13      [19]   47 	ld e_ia_puntero_st_l (ix), l
                             48 
                             49 
                             50 
   002A 3D            [ 4]   51 	dec a
   002B C8            [11]   52 	ret z
                             53 
                             54 	
   002C 11 17 00      [10]   55 	ld de, #siceof_e
   002F DD 19         [15]   56 	add ix, de
   0031 18 F1         [12]   57 	jr _loop_init
                             58 	
                             59 
                             60 
                             61 
                             62 ;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             63 ;;UPDATE
                             64 ;;;;;;;;;;;;;;;;;;;;;;;;;;;
   0033                      65 sys_ai_control_update::
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 10.
Hexadecimal [16-Bits]



                             66 
                     0034    67 _cont_entidad=.+1
   0033 3E 00         [ 7]   68 ld a, #00	
   0035 32 73 00      [13]   69 ld (_ent_counter),a
                             70 
                     003A    71 _ent_array_prt = .+2
   0038 DD 21 00 00   [14]   72 	ld ix, #0x0000
                             73 
                     003E    74 _ent_array_inicio = .+2
   003C FD 21 00 00   [14]   75 	ld iy, #0x0000
                             76 
   0040                      77 _loop:
   0040 DD 7E 0C      [19]   78 	ld a,e_dead(ix)
   0043 3D            [ 4]   79 	dec a
   0044 28 2C         [12]   80 	jr z ,_canon_muerto
   0046 DD 7E 09      [19]   81 	ld a , e_ia_st(ix)   ;; estado de la entidad
   0049 FE 00         [ 7]   82 	cp #e_ia_st_noIA
   004B 28 25         [12]   83 	jr z ,_no_ia_ent
                             84 
                             85 
   004D                      86 _IA_ent::
                             87 
                             88 		
   004D F5            [11]   89 	push af	
   004E FD E5         [15]   90 		push iy
   0050 21 01 00      [10]   91 			ld hl, #_contador_ia
   0053 7E            [ 7]   92 			ld a, (hl)
   0054 3D            [ 4]   93 			dec a
   0055 28 02         [12]   94 			jr z, _hacer_shot
   0057                      95 			_no_hago_shot:
   0057 18 09         [12]   96 				jr  _no_disparamos
   0059                      97 			_hacer_shot:
   0059 3A 00 00      [13]   98 				ld a,(_iteraciones_ia)
   005C 77            [ 7]   99 				ld (hl), a
                            100 
                            101 
   005D CD 80 00      [17]  102 				call _compr_shoot	
   0060 18 01         [12]  103 				jr _continue
   0062                     104 			_no_disparamos:
   0062 77            [ 7]  105 			ld (hl), a
   0063                     106 			_continue:
   0063 FD E1         [14]  107 		pop iy
   0065 F1            [10]  108 	pop af
                            109 
                            110 
   0066 DD 6E 13      [19]  111 	ld  l,e_ia_puntero_st_l(ix)
   0069 DD 66 12      [19]  112 	ld  h,e_ia_puntero_st_h(ix)
   006C 22 70 00      [16]  113 	ld (_puntero_a_stado), hl
                            114 
                            115 
                     0070   116 	_puntero_a_stado =.+1
   006F CD 00 00      [17]  117 	call  0000
                            118 	
                            119 
                            120 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 11.
Hexadecimal [16-Bits]



                            121 
                            122 	
                            123 
                            124 	
   0072                     125 _no_ia_ent:
   0072                     126 _canon_muerto:
                     0073   127 _ent_counter =.+1
   0072 3E 00         [ 7]  128 	ld a , #0
   0074 3D            [ 4]  129 	dec a
   0075 C8            [11]  130 	ret z
                            131 
   0076 32 73 00      [13]  132 	ld (_ent_counter),a
   0079 11 17 00      [10]  133 	ld de, #siceof_e
   007C DD 19         [15]  134 	add ix, de
                            135 	
   007E 18 C0         [12]  136 	jr _loop
                            137 	
                            138 
                            139 
                            140 
                            141 
                            142 
                            143 
                            144 ;;;;;;;;;;;;;;;;;;;;;
                            145 ;;FUNCIONES
                            146 ;;;;;;;;;;;;;;;;;;;;;;
                            147 
                            148 ;;
                            149 ;;conp_shoot
                            150 ;;
                            151 ;;INPUT
                            152 ;;ix PUNTERO DEL CANON ACTUAL
                            153 ;;iy PUNTERO AL PRIMER CANON
   0080                     154 _compr_shoot::
                            155 
                            156 
                            157 	
                            158 
                            159 
   0080 CD 00 00      [17]  160 	call entityman_num_entities
   0083 57            [ 4]  161 	ld d , a			;;contador de canons
                            162 	
                            163 	
                            164 
   0084                     165 	_loop_shot:
                            166 
   0084 FD 7E 0C      [19]  167 	ld a, e_dead(iy)
   0087 3D            [ 4]  168 	dec a
   0088 CA 15 01      [10]  169 	jp z, _canon_muerto_sh
                            170 
   008B 1E 00         [ 7]  171 	ld e, #0			;;el comprobador de x lo porngo a 0
                            172 
                            173 	
                            174 	;; comprobar colision en x
   008D DD 46 00      [19]  175 	ld b, e_x(ix) 		;; esquina izquierda ix
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 12.
Hexadecimal [16-Bits]



   0090 DD 7E 14      [19]  176 	ld a, e_ancho(ix)
   0093 80            [ 4]  177 	add b
   0094 4F            [ 4]  178 	ld c, a			;; izquierda derecha ix
                            179 	
   0095 FD 7E 00      [19]  180 	ld a, e_x(iy)		;; esquina izquierda iy
   0098 91            [ 4]  181 	sub c
                            182 
   0099 30 0B         [12]  183 	jr nc, _no_colision_x
                            184 	;; segunda comprobacion
   009B FD 7E 00      [19]  185 	ld a, e_x(iy)
   009E FD 86 14      [19]  186 	add e_ancho(iy)
   00A1 90            [ 4]  187 	sub b
                            188 
   00A2 38 02         [12]  189 	jr c, _no_colision_x		
   00A4                     190 	_hay_colision_en_x:
   00A4 1E 01         [ 7]  191 	ld e, #1			;; si la x es igual el comprobador de la x lo pongo a 1
                            192 
   00A6                     193 	_no_colision_x:			
                            194 	
                            195 
                            196 	;;comprobar colisiones en y
                            197 
   00A6 DD 46 01      [19]  198 	ld b, e_y(ix) 
   00A9 DD 7E 15      [19]  199 	ld a ,e_alto(ix)	
   00AC 80            [ 4]  200 	add b
   00AD 4F            [ 4]  201 	ld c ,a
                            202 
   00AE FD 7E 01      [19]  203 	ld a, e_y(iy)
   00B1 91            [ 4]  204 	sub c
   00B2 30 46         [12]  205 	jr nc , _no_colision_y
                            206 	;;segunda comprobacion
   00B4 FD 7E 01      [19]  207 	ld a, e_y(iy)
   00B7 FD 86 15      [19]  208 	add e_alto(iy)
   00BA 90            [ 4]  209 	sub b
                            210 	
   00BB 38 3D         [12]  211 	jr c, _no_colision_y
   00BD 1D            [ 4]  212 	dec e				;; la y es igual , compruebo la x
   00BE 28 55         [12]  213 	jr z, _equals
                            214 		;; solo es igual en y
   00C0 FD 7E 00      [19]  215 		ld a, e_x(iy) 		
   00C3 DD 96 00      [19]  216 		sub e_x(ix)			;; hago una resta de las posiciones en x
   00C6 30 29         [12]  217 		jr nc, _posicion_menor
   00C8                     218 		_posicion_mayo:		;;estamos a la derecha	
   00C8 DD 7E 0A      [19]  219 			ld a, e_dir(ix)		
   00CB FE 01         [ 7]  220 			cp #e_dir_left		;; compruebo si tiene dispara a la izquierda
   00CD 28 02         [12]  221 			jr z, _disparamos
   00CF 18 44         [12]  222 			jr  _salir_shot
   00D1                     223 			_disparamos:
                            224 
                            225 			
                            226 			
                            227 
                            228 			
                            229 			
   00D1 DD E5         [15]  230 			push ix
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 13.
Hexadecimal [16-Bits]



   00D3 C5            [11]  231 			push bc
   00D4 FD E5         [15]  232 			push iy
   00D6 FD 7E 09      [19]  233 			ld a, e_ia_st(iy)
   00D9 FE 00         [ 7]  234 			cp #e_ia_st_noIA
   00DB 20 03         [12]  235 			jr nz, _es_ia
   00DD                     236 			_no_es_ia:
   00DD CD 00 00      [17]  237 				call hacer_disparo2
   00E0                     238 			_es_ia:
                            239 
   00E0 CD 00 00      [17]  240 				call get_gamemode
   00E3 FE 05         [ 7]  241 				cp #5
   00E5 28 03         [12]  242 				jr z,_no_disparar_ia
   00E7                     243 				_disparamos_ia:
   00E7 CD 00 00      [17]  244 					call hacer_disparo2
   00EA                     245 				_no_disparar_ia:
                            246 
   00EA FD E1         [14]  247 			pop iy
   00EC C1            [10]  248 			pop bc			
   00ED DD E1         [14]  249 			pop ix
                            250 			
                            251 			
   00EF 18 24         [12]  252 		jr   _salir_shot
   00F1                     253 		_posicion_menor:
   00F1 DD 7E 0A      [19]  254 			ld a, e_dir(ix)		
   00F4 FE 03         [ 7]  255 			cp #e_dir_right		;; compruebo si tiene dispara a la izquierda
   00F6 28 D9         [12]  256 			jr z, _disparamos
   00F8 18 1B         [12]  257 			jr   _salir_shot
                            258 			
                            259 	
                            260 		
   00FA                     261 	_no_colision_y:		;; solo es 
   00FA 1D            [ 4]  262 	dec e				;; comprobamos si es igual en x
   00FB 20 18         [12]  263 	jr nz, _no_equals
                            264 	;; solo es igual  en x
   00FD FD 7E 01      [19]  265 	ld a, e_y(iy) 		
   0100 DD 96 01      [19]  266 		sub e_y(ix)			;; hago una resta de las posiciones en x
   0103 30 09         [12]  267 		jr nc, _posicion_arriba
   0105                     268 		_posicion_abajo:		;;estamos a la abajo	
   0105 DD 7E 0A      [19]  269 			ld a, e_dir(ix)		
   0108 FE 02         [ 7]  270 			cp #e_dir_top		;; compruebo si tiene dispara a la izquierda
   010A 28 C5         [12]  271 			jr z, _disparamos
                            272 			
                            273 				
                            274 
   010C 18 07         [12]  275 		jr   _salir_shot
   010E                     276 		_posicion_arriba:
   010E DD 7E 0A      [19]  277 			ld a, e_dir(ix)		
   0111 FE 04         [ 7]  278 			cp #e_dir_bott		;; compruebo si tiene dispara a la izquierda
   0113 28 BC         [12]  279 			jr z, _disparamos
                            280 		
                            281 			
                            282 	
                            283 		
                            284 
                            285 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 14.
Hexadecimal [16-Bits]



   0115                     286 	_salir_shot:
   0115                     287 	_no_equals:
   0115                     288 	_equals:
   0115                     289 	_canon_muerto_sh:
                            290 
   0115 7A            [ 4]  291 	ld a, d
   0116 3D            [ 4]  292 	dec a
   0117 C8            [11]  293 	ret z
                            294 
                            295 	
   0118 11 17 00      [10]  296 	ld de, #siceof_e
   011B FD 19         [15]  297 	add iy, de
   011D 57            [ 4]  298 	ld d, a
                            299 	
   011E C3 84 00      [10]  300 	jp _loop_shot
   0121 C9            [10]  301 ret
                            302 
                            303 
                            304 ;;
                            305 ;; STAND BY
                            306 ;;
   0122                     307 sys_ia_stand_by::
                            308 
                            309 	
                            310 
   0122 21 A9 01      [10]  311 	ld hl, #sys_ai_patrol
                            312 
                            313 	
   0125 DD 75 13      [19]  314 	ld e_ia_puntero_st_l(ix) ,l
   0128 DD 74 12      [19]  315 	ld e_ia_puntero_st_h(ix) ,h
                            316 
                            317 	
                            318 
                            319 
   012B C9            [10]  320 	ret
                            321 
                            322 
                            323 
                            324 ;;
                            325 ;;MOVE TO
                            326 ;;
   012C                     327 sys_is_move_to::
   012C 06 01         [ 7]  328 	ld b, #1			;; valor para comprobar si en x hemos llegado
   012E DD 7E 0D      [19]  329 	ld a, e_ia_x(ix)    ;;a = x_objetivo
   0131 DD 96 00      [19]  330 	sub e_x(ix)         ;;A= OBJ_X -X
   0134 30 13         [12]  331 	jr nc, _obj_greater_or_equal_x ;; if( obj _x - x >0)
                            332 
                            333 
                            334 
   0136                     335 _objx_lesser_x:
                            336 
   0136 DD 36 06 00   [19]  337 	ld e_vx(ix), #0
   013A DD 7E 0A      [19]  338 	ld a,e_dir(ix)
   013D FE 01         [ 7]  339 	cp #e_dir_left
   013F 20 06         [12]  340 	jr nz, _no_mira_izquierda
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 15.
Hexadecimal [16-Bits]



   0141 3A 04 00      [13]  341 		ld a, (_vel_x_ia_n) 	
   0144 DD 77 06      [19]  342 		ld e_vx(ix), a	
   0147                     343 	_no_mira_izquierda:
                            344 
   0147 18 1B         [12]  345 	jr _endif_x
                            346 
                            347 
   0149                     348 _obj_greater_or_equal_x:
   0149 28 13         [12]  349 	jr z,_arrived_x
   014B DD 36 06 00   [19]  350 		ld e_vx(ix), #0
   014F DD 7E 0A      [19]  351 		ld a,e_dir(ix)
   0152 FE 03         [ 7]  352 		cp #e_dir_right 
   0154 20 06         [12]  353 		jr nz, _no_mira_derecha
   0156 3A 02 00      [13]  354 			ld a, (_vel_x_ia)
   0159 DD 77 06      [19]  355 			ld e_vx(ix), a
   015C                     356 		_no_mira_derecha:
                            357 	
   015C 18 06         [12]  358 	jr _endif_x
   015E                     359 _arrived_x:
   015E DD 36 06 00   [19]  360 	ld e_vx(ix), #0
   0162 06 00         [ 7]  361 	ld b, #0
                            362 	
                            363 
   0164                     364 _endif_x:
                            365 	
                            366 
                            367 
                            368 
   0164 DD 7E 0E      [19]  369 	ld a, e_ia_y(ix)    ;;a = x_objetivo
   0167 DD 96 01      [19]  370 	sub e_y(ix)         ;;A= OBJ_X -X
   016A 30 13         [12]  371 	jr nc, _obj_greater_or_equal_y ;; if( obj _x - x >0)
                            372 
                            373 
                            374 
   016C                     375 _objx_lesser_y:
   016C DD 36 07 00   [19]  376 		ld e_vy(ix), #0
   0170 DD 7E 0A      [19]  377 		ld a,e_dir(ix)
   0173 FE 02         [ 7]  378 		cp #e_dir_top
   0175 20 06         [12]  379 		jr nz, _no_mira_arriba
   0177 3A 05 00      [13]  380 			ld a,(_vel_y_ia_n)
   017A DD 77 07      [19]  381 			ld e_vy(ix), a
                            382 	
                            383 	
   017D                     384 	_no_mira_arriba:
   017D 18 29         [12]  385 	jr _endif_y
                            386 
                            387 
   017F                     388 _obj_greater_or_equal_y:
   017F 28 13         [12]  389 	jr z,_arrived_y
   0181 DD 36 07 00   [19]  390 		ld e_vy(ix), #0
   0185 DD 7E 0A      [19]  391 		ld a,e_dir(ix)
   0188 FE 04         [ 7]  392 		cp #e_dir_bott
   018A 20 06         [12]  393 		jr nz, _no_mira_abajo
   018C 3A 03 00      [13]  394 		ld a,(_vel_y_ia)
   018F DD 77 07      [19]  395 		ld e_vy(ix), a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 16.
Hexadecimal [16-Bits]



   0192                     396 		_no_mira_abajo:
                            397 
                            398 	
   0192 18 14         [12]  399 	jr _endif_y
   0194                     400 _arrived_y:
                            401 
   0194 DD 36 07 00   [19]  402 	ld e_vy(ix), #0	
                            403 	
   0198 B0            [ 4]  404 	or b
   0199 20 0D         [12]  405 	jr nz, _endif_y
                            406 	;; x e y son las dos 0
                            407 
   019B DD 7E 0F      [19]  408 	ld a , e_ia_st_prev(ix)				;; ponto en mi estado actual el anterior
   019E DD 77 09      [19]  409 	ld e_ia_st(ix), a
   01A1 DD 36 0F 02   [19]  410 	ld e_ia_st_prev(ix), #e_ia_st_move_to	;; actualizo el estado 
   01A5 CD E0 01      [17]  411 	call actualizar_puntero
                            412 
                            413 	
                            414 
                            415 
                            416 
   01A8                     417 _endif_y:
   01A8 C9            [10]  418 ret
                            419 
                            420 
                            421 
                            422 ;;;;;;;;;;;;;
                            423 ;;PATROL;;;;
                            424 ;;;;;;;;;;;;
                            425 
   01A9                     426 sys_ai_patrol::
                            427 	;; hl es el puntero al primer byte de la patrulla 
   01A9 DD 66 10      [19]  428 	ld h , e_ia_puntero_patrol_h(ix)
   01AC DD 6E 11      [19]  429 	ld l , e_ia_puntero_patrol_l(ix)
                            430 
                            431 
                            432 	;; cargar cordenadas x y
   01AF 7E            [ 7]  433 	ld a, (hl)
   01B0 FE FF         [ 7]  434 	cp #patrol_invalid_move_x	;; comprobar si es el final de la patrulla
   01B2 28 21         [12]  435 	jr z, _reset_patrol					;; salimos 
                            436 
   01B4 DD 77 0D      [19]  437 	ld e_ia_x(ix), a
   01B7 23            [ 6]  438 	inc hl
   01B8 7E            [ 7]  439 	ld a, (hl)
   01B9 DD 77 0E      [19]  440 	ld e_ia_y(ix), a
                            441 
                            442 	;; cambiar el puntero a la siguiente posicion
   01BC 23            [ 6]  443 	inc hl
   01BD DD 74 10      [19]  444 	ld e_ia_puntero_patrol_h (ix), h
   01C0 DD 75 11      [19]  445 	ld e_ia_puntero_patrol_l (ix), l
                            446 
                            447 	;; cambio al estado move to
   01C3 DD 36 0F 03   [19]  448 	ld e_ia_st_prev(ix), #e_ia_st_patron
   01C7 DD 36 09 02   [19]  449 	ld e_ia_st(ix), #e_ia_st_move_to
                            450 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 17.
Hexadecimal [16-Bits]



   01CB 21 2C 01      [10]  451 	ld hl, #sys_is_move_to
                            452 	
                            453 
   01CE DD 75 13      [19]  454 	ld e_ia_puntero_st_l(ix) ,l
   01D1 DD 74 12      [19]  455 	ld e_ia_puntero_st_h(ix) ,h
                            456 
   01D4 C9            [10]  457 	ret
                            458 
   01D5                     459 _reset_patrol:
                            460 
   01D5 23            [ 6]  461 	inc hl
   01D6 7E            [ 7]  462 	ld a , (hl)
   01D7 DD 77 11      [19]  463 	ld e_ia_puntero_patrol_l (ix), a
   01DA 23            [ 6]  464 	inc hl
   01DB 7E            [ 7]  465 	ld a , (hl)
   01DC DD 77 10      [19]  466 	ld e_ia_puntero_patrol_h (ix), a
                            467 
                            468 
   01DF C9            [10]  469 	ret
                            470 
                            471 
                            472 
   01E0                     473 actualizar_puntero:
   01E0 3D            [ 4]  474 	dec a
   01E1 28 06         [12]  475 	jr z, _stan
   01E3 3D            [ 4]  476 	dec a
   01E4 28 08         [12]  477 	jr z, _move_to	
   01E6 3D            [ 4]  478 	dec a
   01E7 28 0A         [12]  479 	jr z, _patron
                            480 
   01E9                     481 _stan:
   01E9 21 22 01      [10]  482 	ld hl, #sys_ia_stand_by
   01EC 18 08         [12]  483 	jr _salir_actualizar
                            484 
                            485 
   01EE                     486 _move_to:
                            487 
   01EE 21 2C 01      [10]  488 	ld hl, #sys_is_move_to	
   01F1 18 03         [12]  489 	jr _salir_actualizar
                            490 
                            491 
   01F3                     492 _patron:
   01F3 21 A9 01      [10]  493 	ld hl, #sys_ai_patrol
                            494 
   01F6                     495 _salir_actualizar:
                            496 	
   01F6 DD 75 13      [19]  497 	ld e_ia_puntero_st_l(ix) ,l
   01F9 DD 74 12      [19]  498 	ld e_ia_puntero_st_h(ix) ,h
                            499 	
                            500 	
   01FC C9            [10]  501 	ret
                            502 
                            503 
                            504 
                            505 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 18.
Hexadecimal [16-Bits]



                            506 
                            507 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                            508 ;;funciones para cambiar los parametros
                            509 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                            510 
                            511 ;;INPUT A DIFICULTAD PARA LA IA
   01FD                     512 cambiar_dificultad_ia::
   01FD FE 01         [ 7]  513 	cp #1
   01FF 28 0C         [12]  514 jr z,_nivel_1
   0201 FE 02         [ 7]  515 	cp #2
   0203 28 0E         [12]  516 jr z,_nivel_2
   0205 FE 03         [ 7]  517 	cp #3
   0207 28 10         [12]  518 jr z,_nivel_3
   0209 FE 04         [ 7]  519 	cp #4
   020B 28 12         [12]  520 jr z,_nivel_4
                            521 
                            522 
   020D                     523 _nivel_1:
   020D 3E 33         [ 7]  524 	ld a, #_dificultad_ia_nive1
   020F 32 00 00      [13]  525 	ld (_iteraciones_ia), a
   0212 C9            [10]  526 	ret
   0213                     527 _nivel_2:
   0213 3E 29         [ 7]  528 	ld a, #_dificultad_ia_nive2
   0215 32 00 00      [13]  529 	ld (_iteraciones_ia), a
   0218 C9            [10]  530 	ret
                            531 
   0219                     532 _nivel_3:
   0219 3E 19         [ 7]  533 	ld a, #_dificultad_ia_nive3
   021B 32 00 00      [13]  534 	ld (_iteraciones_ia), a
   021E C9            [10]  535 	ret
   021F                     536 _nivel_4:
   021F 3E 0F         [ 7]  537 	ld a, #_dificultad_ia_nive4
   0221 32 00 00      [13]  538 	ld (_iteraciones_ia), a
                            539 
                            540 
   0224 C9            [10]  541 ret
                            542 
                            543 
                            544 ;;INPUT A EL NIVEL DE VELOCIDAD PARA LA IA
   0225                     545 cambiar_velocidad_ia::
                            546 
   0225 FE 01         [ 7]  547 	cp #1
   0227 28 04         [12]  548 jr z,_nivel_1_v
   0229 FE 02         [ 7]  549 	cp #2
   022B 28 15         [12]  550 jr z,_nivel_2_v
                            551 	
                            552 
                            553 
                            554 
                            555 
   022D                     556 _nivel_1_v:
   022D 3E 01         [ 7]  557 	ld a, #_nivel_1x
   022F 32 02 00      [13]  558 	ld (_vel_x_ia), a
   0232 3E FF         [ 7]  559 	ld a, #_nivel_1x_n
   0234 32 04 00      [13]  560 	ld (_vel_x_ia_n), a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 19.
Hexadecimal [16-Bits]



   0237 3E 04         [ 7]  561 	ld a, #_nivel_1y
   0239 32 03 00      [13]  562 	ld (_vel_y_ia), a
   023C 3E FC         [ 7]  563 	ld a, #_nivel_1y_n
   023E 32 05 00      [13]  564 	ld (_vel_y_ia_n), a
                            565 
   0241 C9            [10]  566 	ret
   0242                     567 _nivel_2_v:
   0242 3E 02         [ 7]  568 	ld a, #_nivel_2x
   0244 32 02 00      [13]  569 	ld (_vel_x_ia), a
   0247 3E FE         [ 7]  570 	ld a, #_nivel_2x_n
   0249 32 04 00      [13]  571 	ld (_vel_x_ia_n), a
   024C 3E 08         [ 7]  572 	ld a, #_nivel_2y
   024E 32 03 00      [13]  573 	ld (_vel_y_ia), a
   0251 3E F8         [ 7]  574 	ld a, #_nivel_2y_n
   0253 32 05 00      [13]  575 	ld (_vel_y_ia_n), a
   0256 C9            [10]  576 	ret
                            577 
